<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trang proxy Shopee và Lọc Liên Kết</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .section {
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 10px;
        }
        .section-header {
            margin-bottom: 15px;
        }
        .link-section, .remove-number-section {
            background-color: #f0f8ff;
        }
        textarea {
            width: 100%;
            margin-bottom: 10px;
        }
        button {
            margin-top: 10px;
        }
        .group-section {
            padding: 10px;
            margin-bottom: 15px;
            border-radius: 5px;
        }
        .header {
            background-color: #f8f9fa;
            padding: 15px;
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            border-bottom: 2px solid #ddd;
        }
        .notification {
            background-color: #ffeb3b;
            color: #000;
            padding: 10px;
            text-align: center;
            font-size: 18px;
            margin-bottom: 20px;
        }
        iframe {
            width: 100%;
            height: 50vh;
            border: none;
        }
    </style>
</head>
<body>
    <div class="header">Trang proxy Shopee và Lọc Liên Kết</div>

    <div class="notification">
        Bạn đang duyệt trang Shopee mà không cần mở ứng dụng Shopee.
    </div>

    <form action="/shopee" method="GET" style="text-align: center; margin-bottom: 20px;">
        <label>Nhập link Shopee: </label>
        <input type="text" name="url" placeholder="https://s.shopee.vn/yourlink" required />
        <button type="submit">Tải trang</button>
    </form>

    {% if content %}
        <div class="iframe-container">
            {{ content|safe }}
        </div>
    {% endif %}

    <h1>Lọc và Thay Thế Liên Kết</h1>

    <div class="section link-section">
        <h2 class="section-header">Lọc và Thay Thế Liên Kết</h2>
        <textarea id="inputText" rows="6" placeholder="Nhập văn bản ở đây để lọc liên kết..."></textarea>
        <button onclick="extractLinks()">Lọc Liên Kết</button>
        <button onclick="clearInput('inputText')">Xóa Văn Bản</button>

        <h3>Các Liên Kết Đã Tìm Thấy:</h3>
        <div id="linkSections"></div>

        <h3>Văn Bản Đã Thay Đổi:</h3>
        <textarea id="outputText" rows="6" readonly></textarea>
        <button id="copyResultButton" onclick="copyResult()" style="display: none;">Sao Chép Kết Quả</button>
        <button onclick="clearInput('outputText')">Xóa Văn Bản</button>
    </div>

    <script>
        let links = [];

        function extractLinks() {
            const text = document.getElementById('inputText').value;
            const linkPattern = /https?:\/\/[^\s]+/g;
            links = text.match(linkPattern) || [];
            const domainMap = {};

            links.forEach(link => {
                const domain = new URL(link).hostname;
                if (!domainMap[domain]) {
                    domainMap[domain] = [];
                }
                domainMap[domain].push(link);
            });

            displayLinks(domainMap);
        }

        function displayLinks(domainMap) {
            const linkSections = document.getElementById('linkSections');
            linkSections.innerHTML = '';

            for (const [domain, domainLinks] of Object.entries(domainMap)) {
                const section = document.createElement('div');
                section.classList.add('domain-section');

                const title = document.createElement('h3');
                title.textContent = `Tên miền: ${domain}`;
                section.appendChild(title);

                const list = document.createElement('ul');
                domainLinks.forEach(link => {
                    const listItem = document.createElement('li');
                    listItem.textContent = link;
                    list.appendChild(listItem);
                });

                section.appendChild(list);
                linkSections.appendChild(section);
            }

            if (Object.keys(domainMap).length === 0) {
                linkSections.innerHTML = '<p>Không tìm thấy liên kết nào.</p>';
            }
        }

        function clearInput(textareaId) {
            document.getElementById(textareaId).value = '';
        }

        function copyResult() {
            const textArea = document.createElement('textarea');
            textArea.value = document.getElementById('outputText').value;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            alert('Đã sao chép kết quả văn bản!');
        }
    </script>
</body>
</html>
